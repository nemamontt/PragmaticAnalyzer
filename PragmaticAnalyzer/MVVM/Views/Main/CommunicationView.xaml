<UserControl x:Class="PragmaticAnalyzer.MVVM.Views.Main.CommunicationView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:PragmaticAnalyzer.MVVM.Views"
             xmlns:assist="clr-namespace:PragmaticAnalyzer.Assistant"
             xmlns:vm="clr-namespace:PragmaticAnalyzer.MVVM.ViewModel.Main"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance vm:CommunicationViewModel}"
             d:DesignHeight="450"
             d:DesignWidth="800">
    <UserControl.Resources>
        <assist:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <ScrollViewer x:Name="MessagesScroll"
                      Grid.Row="0"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Margin="5"
                      ScrollChanged="MessagesScroll_ScrollChanged">
            <ItemsControl ItemsSource="{Binding Messages}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border x:Name="MessageBorder"
                                CornerRadius="12"
                                Padding="12,8"
                                Margin="8,4"
                                MaxWidth="600">
                            <StackPanel>
                                <TextBlock Text="{Binding Text}"
                                           TextWrapping="Wrap"
                                           FontSize="16"
                                           FontFamily="Consolas"
                                           FontWeight="Bold"/>
                                <TextBlock Text="{Binding Timestamp, StringFormat='HH:mm'}"
                                           Foreground="#888"
                                           FontSize="10"
                                           HorizontalAlignment="Right"
                                           Margin="0,4,0,0" />
                            </StackPanel>
                        </Border>
                        <DataTemplate.Triggers>
                            <DataTrigger Binding="{Binding Sender}"
                                         Value="User">
                                <Setter TargetName="MessageBorder"
                                        Property="Background"
                                        Value="#4FC3F7" />
                                <Setter TargetName="MessageBorder"
                                        Property="HorizontalAlignment"
                                        Value="Right" />
                                <Setter TargetName="MessageBorder"
                                        Property="Margin"
                                        Value="60,4,8,4" />
                                <Setter TargetName="MessageBorder"
                                        Property="CornerRadius"
                                        Value="12,12,4,12" />
                            </DataTrigger>

                            <DataTrigger Binding="{Binding Sender}"
                                         Value="Assistant">
                                <Setter TargetName="MessageBorder"
                                        Property="Background"
                                        Value="#505050" />
                                <Setter TargetName="MessageBorder"
                                        Property="HorizontalAlignment"
                                        Value="Left" />
                                <Setter TargetName="MessageBorder"
                                        Property="Margin"
                                        Value="8,4,60,4" />
                                <Setter TargetName="MessageBorder"
                                        Property="CornerRadius"
                                        Value="12,12,12,4" />
                            </DataTrigger>
                        </DataTemplate.Triggers>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <ProgressBar Grid.Row="0"
                     IsIndeterminate="{Binding IsSending}"
                     Visibility="{Binding IsSending, Converter={StaticResource BoolToVisibilityConverter}}"
                     VerticalAlignment="Bottom"
                     Height="4"
                     Margin="5"/>

        <Grid Grid.Row="1"
              Margin="8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <Grid.RowDefinitions>
                <RowDefinition />
                <RowDefinition />
            </Grid.RowDefinitions>

            <TextBox Grid.Column="0"
                     Grid.Row="0"
                     Grid.RowSpan="2"
                     Height="90"
                     x:Name="InputBox"
                     AcceptsReturn="False"
                     VerticalContentAlignment="Center"
                     Text="{Binding UserInput, UpdateSourceTrigger=PropertyChanged}"
                     Style="{StaticResource RoundedTextBoxStyle}"
                     KeyDown="InputBox_KeyDown" />

            <Button Grid.Column="1"
                    Grid.Row="0"
                    Content="➤"
                    Command="{Binding SendCommand}"
                    Style="{StaticResource OutlinedGrayButtonStyle}" />

            <Button Grid.Column="1"
                    Grid.Row="1"
                    Content="Очистить"
                    Command="{Binding ClearCommand}"
                    Style="{StaticResource OutlinedGrayButtonStyle}" />
        </Grid>
    </Grid>
</UserControl>